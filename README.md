# Nuppeppou

This is Nuppeppou, a Battlesnake implemented in Python. It's deployed with [Replit](https://repl.it). `src/logics` and `src/utils` are from [`BattlesnakeOfficial/training-snakes`](https://github.com/BattlesnakeOfficial/training-snakes). `src\src` is from [`BattlesnakeOfficial/coding-badly`](https://github.com/BattlesnakeOfficial/coding-badly).

## Technologies Used

* [Python3](https://www.python.org/)
* [Flask](https://flask.palletsprojects.com/)


## Profile

* [Daedalean](https://play.battlesnake.com/u/daedalean/)

---

## Customizations

Nuppeppou presently uses these settings for personalizing its appearance:

```python
return {
    "apiversion": "1",
    "author": "daedalean",
    "color": "#E80978",
    "head": "pixel",
    "tail": "pixel",
    "version": "0.0.1-beta",
}

```

## Behavior

On the start of each game, Nuppeppou initializes an [efficiently updatable neural network](https://en.wikipedia.org/wiki/Efficiently_updatable_neural_network) if the game settings and ruleset are identical to the game settings and ruleset for Global Duels.

The input feature set for the efficiently updatable neural networks are `(square, piece)`. There are 121 squares on the board. There are 6 piece types: health points, body types, lengths, directions to the head, directions to the tail, snakes, and food. There are 100 health points, from 1 to 100. There are 2 body types, head and body. There are 119 lengths, from 3 to 121. There are 5 directions to the head; up, down, left, right, and none. There are 5 directions to the tail; up, down, left, right, and none. There are 2 snakes, Nuppeppou and the opponent. There is 1 food, food. Therefore, there are `121×(100+2+119+5+5+2+1)=28314` such tuples. If there is a piece `P` on the square `S`, then the input `(S, C)` is set to 1. Otherwise, it is set to 0.

The layers used in the efficiently updatable neural networks are three linear layers, 28314→256, 256→256, 256→4. All layers are linear and all hidden neurons use the ReLU activation function.

The efficiently updatable neural networks were trained with implicit Q-learning. In particular, a training data set, validation data set, and test dat set were generated by creating games with [`altersaddle/untimely-neglected-wearable`](https://github.com/altersaddle/untimely-neglected-wearable).

On every turn of each game, Nuppeppou first removes moves that move Nuppeppou back on its own neck, hit walls, hit itself, and collide with others from possibility. If all moves are removed from possibility, then Nuppeppou moves randomly. Otherwise, if an efficiently updatable neural network has been initialized for this game, then Nuppeppou uses the the efficiently updatable neural network to get logits for each move and selects the possible move assigned the greatest logit. Otherwise, Nuppeppou selects a random possible move.

On the end of each game, Nuppeppou deallocates some server-side resources if they exist. In particular, Nuppeppou may deallocate memory of the previous state that was needed for updating accumulators in efficiently updatable neural networks. Nuppeppou may also deallocate the efficiently updatable neural network initialized for the game.
